---
import EventSchema from './EventSchema.astro';
import type { CalendarEvent } from '../utils/types';

interface Props {
  event: CalendarEvent;
}

const { event } = Astro.props;

// Parse the date to extract day of week and formatted date
const eventDate = new Date(event.startDate);
const dayOfWeek = eventDate.toLocaleDateString('en-US', { weekday: 'short' });
const month = eventDate.toLocaleDateString('en-US', { month: 'short' });
const day = eventDate.getDate();

// Format day with ordinal suffix (1st, 2nd, 3rd, etc.)
const getOrdinalSuffix = (n: number) => {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return n + (s[(v - 20) % 10] || s[v] || s[0]);
};

const formattedDay = getOrdinalSuffix(day);
---

<article class="event-card">
  <div class="event-card__date-column">
    <div class="event-card__day">{dayOfWeek}</div>
    <div class="event-card__date" set:html={`${month}<br>${formattedDay}`}></div>
  </div>

  <div class="event-card__details-column">
    <h3 class="event-card__venue">{event.venue}</h3>
    {event.description && (
      <p class="event-card__description" set:html={event.description}></p>
    )}
  </div>

  <div class="event-card__time-column">
    <p class="event-card__time">{event.timeRange}</p>
    <p class="event-card__address">{event.location}</p>
  </div>

  <EventSchema event={event} />
</article>
